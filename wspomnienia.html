<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link rel="icon" type="image/svg+xml" href="zasoby/logo.svg">
<title>Album</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
    touch-action: manipulation;
}

.fullscreen-gallery {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100dvh; /* dynamic viewport height */
    background: black;
    display: flex;
    align-items: center;
    justify-content: center;
}

#mediaContainer {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

/* Wspólne ustawienia dla IMG i VIDEO */
#mediaContainer img,
#mediaContainer video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    max-width: 100%;
    max-height: 100%;
    display: block;
    transition: opacity 0.4s ease;
    background: black;
}

/* Przyciski */
.nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(0,0,0,0.7);
    color: red;
    border: 2px solid red;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    user-select: none;
}

.nav-left { left: 20px; }
.nav-right { right: 20px; }

@media (max-width: 600px) {
    .nav-btn {
        width: 50px;
        height: 50px;
        font-size: 18px;
    }
}
</style>
</head>
<body>

<div class="fullscreen-gallery">
    <button class="nav-btn nav-left" data-dir="-1">&#10094;</button>
    <div id="mediaContainer"></div>
    <button class="nav-btn nav-right" data-dir="1">&#10095;</button>
</div>

<script>
const mediaFiles = [
    "zasoby/obraz1.jpeg",
    "zasoby/film1.mp4",
    "zasoby/obraz2.jpeg",
    "zasoby/film2.mp4",
    "zasoby/film3.mp4",
    "zasoby/film4.mp4",
    "zasoby/obraz3.jpeg",
    "zasoby/obraz4.jpeg",
    "zasoby/film5.mp4",
    "zasoby/obraz5.jpeg",
    "zasoby/obraz6.jpeg",
];

let currentIndex = 0;
let isAnimating = false;

const container = document.getElementById("mediaContainer");
const buttons = document.querySelectorAll(".nav-btn");

/* Preload obrazów */
mediaFiles.forEach(src => {
    if (src.match(/\.(jpg|jpeg|png|gif)$/i)) {
        const img = new Image();
        img.src = src;
    }
});

/* Tworzenie elementu */
function createMediaElement(src) {
    const extension = src.split('.').pop().toLowerCase();

    if (["mp4", "webm", "ogg"].includes(extension)) {
        const video = document.createElement("video");
        video.src = src;

        video.controls = true;
        video.autoplay = true;
        video.muted = true;          // wymagane do autoplay mobile
        video.playsInline = true;    // iOS fix
        video.preload = "auto";

        video.style.opacity = 0;

        video.addEventListener("loadedmetadata", () => {
            video.play().catch(() => {});
        });

        return video;
    } else {
        const img = document.createElement("img");
        img.src = src;
        img.style.opacity = 0;
        return img;
    }
}

/* Zmiana media */
function changeMedia(direction) {
    if (isAnimating) return;
    isAnimating = true;

    currentIndex = (currentIndex + direction + mediaFiles.length) % mediaFiles.length;
    const oldMedia = container.firstChild;

    if (oldMedia) {
        if (oldMedia.tagName === "VIDEO") {
            oldMedia.pause();
            oldMedia.removeAttribute("src");
            oldMedia.load();
        }

        oldMedia.style.opacity = 0;

        setTimeout(() => {
            container.innerHTML = "";
            const newMedia = createMediaElement(mediaFiles[currentIndex]);
            container.appendChild(newMedia);

            requestAnimationFrame(() => {
                newMedia.style.opacity = 1;
                isAnimating = false;
            });

        }, 400);
    } else {
        const newMedia = createMediaElement(mediaFiles[currentIndex]);
        container.appendChild(newMedia);
        requestAnimationFrame(() => {
            newMedia.style.opacity = 1;
            isAnimating = false;
        });
    }
}

/* Start */
const startMedia = createMediaElement(mediaFiles[currentIndex]);
container.appendChild(startMedia);
requestAnimationFrame(() => {
    startMedia.style.opacity = 1;
});

/* Przyciski */
buttons.forEach(btn => {
    btn.addEventListener("click", () => {
        const direction = parseInt(btn.dataset.dir);
        changeMedia(direction);
    });
});

/* Swipe na telefonie */
let touchStartX = 0;
let touchEndX = 0;

container.addEventListener("touchstart", e => {
    touchStartX = e.changedTouches[0].screenX;
});

container.addEventListener("touchend", e => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
});

function handleSwipe() {
    const threshold = 50;
    if (touchEndX < touchStartX - threshold) {
        changeMedia(1);
    }
    if (touchEndX > touchStartX + threshold) {
        changeMedia(-1);
    }
}

/* Klawiatura */
document.addEventListener("keydown", e => {
    if (e.key === "ArrowRight") changeMedia(1);
    if (e.key === "ArrowLeft") changeMedia(-1);
});
</script>

</body>
</html>